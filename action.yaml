name: "Ory CLI"
description: "Install and authenticate with Ory CLI"
inputs:
  username:
    description: "Ory username"
    required: true
  password:
    description: "Ory password"
    required: true
  version:
    description: "Ory CLI Version"
    required: true
runs:
  using: "composite"
  steps:
    - run: sudo apt-get install -y expect
      shell: bash
    - run: bash <(curl https://raw.githubusercontent.com/ory/meta/master/install.sh) -b . ory ${{ inputs.version }} && sudo mv ./ory /usr/local/bin/
      shell: bash
    - run: |
        /usr/bin/expect <<'EOF'
        spawn ory auth
        expect "Do you want to sign in to an existing Ory Network account?"
        send -- "y\r"
        expect "Email:"
        send -- "${{ inputs.username }}\r"
        expect "Password:"
        send -- "${{ inputs.password }}\r"
        expect eof
        EOF
      shell: bash
